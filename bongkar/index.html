<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Form Bongkar GRECEP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <style>
    body {
      background: linear-gradient(135deg,rgb(11, 51, 85) 0%,rgb(0, 48, 119) 100%);
      min-height:100vh;
      display:flex; align-items:center; justify-content:center;
      padding:1rem;
    }
    .card {
      border:none; border-radius:1rem;
      box-shadow:0 .5rem 1.5rem rgba(0,0,0,.1);
      max-width:420px; width:100%; overflow:hidden;
    }
    .card-header {
      background: url('images/Game-Royal-Dream-1589676258.jpg') center/cover no-repeat;
      height:140px;
    }
    .logo-container {
      width:100px; height:100px;
      border:4px solid #fff; border-radius:50%;
      overflow:hidden; background:#fff;
      margin:-50px auto 10px;
      box-shadow:0 .5rem 1rem rgba(0,0,0,.1);
    }
    .logo-container img {
      width:100%; height:100%; object-fit:cover;
    }
    .card-body { padding:2rem; }
    .alert-info {
      background:#e1ecff; color:#007bff;
      font-size:.9rem; text-align:center; border:none;
      margin-bottom:1rem;
    }
    .form-control:focus {
      border-color: #007bff;
      box-shadow:0 0 .2rem #007bff33;
    }
    .btn-bongkar {
      background: #007bff;
      border:none; border-radius:.5rem;
      color:#fff; transition:transform .2s;
    }
    .btn-bongkar:hover { transform:scale(1.02); }
    #error { height:1.2em; }
  </style>
</head>
<body>
  <div class="card">
    <div class="card-header"></div>
    <div class="logo-container">
      <img src="images/grecep.jpg" alt="Logo">
    </div>
    <div class="card-body">
      <h4 class="text-center mb-3" style="color: #007bff;">
        Form Bongkar GRECEP
      </h4>
      <div class="alert alert-info">Proses minimal 1-3 menit setelah pemesanan</div>
      <form id="bongkarForm">
        
        <!-- ID Bongkar Kami -->
        <div class="mb-4 text-center">
          <label class="form-label fw-bold text-uppercase d-block">ID Bongkar Kami</label>
          <div class="input-group justify-content-center mx-auto" style="max-width: 320px;">
            <span class="input-group-text bg-primary text-white">
              <i class="bi bi-hash"></i>
            </span>
            <input type="text" id="iddomino" class="form-control border-primary fw-semibold fs-5 text-center" value="26321555" readonly>
            <button class="btn btn-outline-primary" type="button" id="copyIdBtn" title="Salin ID">
              <i class="bi bi-clipboard"></i>
            </button>
          </div>
          <div id="copyFeedback" class="form-text text-success mt-2" style="display:none;">✅ ID berhasil disalin!</div>
        </div>

        <!-- ID Game -->
        <div class="mb-3 input-group">
          <span class="input-group-text bg-white"><i class="bi bi-controller" style="color: #007bff;"></i></span>
          <input type="text" id="id" class="form-control" placeholder="ID Game" required>
        </div>

        <!-- Jumlah Bongkar -->
        <div class="mb-1 input-group">
          <span class="input-group-text bg-white"><i class="bi bi-coin" style="color: #007bff;"></i></span>
          <input type="text" id="jumlah" class="form-control" placeholder="Contoh: 500M, 1B, 1.5B" required>
        </div>
        <div id="error" class="text-danger small mb-1"></div>

        <!-- Estimasi Dana -->
        <div class="mb-4 input-group">
          <span class="input-group-text bg-white"><i class="bi bi-wallet2" style="color: #007bff;"></i></span>
          <input type="text" id="estimasi" class="form-control" placeholder="Rp 0" readonly>
        </div>

        <!-- Bank -->
        <div class="mb-3 input-group">
          <span class="input-group-text bg-white"><i class="bi bi-bank" style="color: #007bff;"></i></span>
          <input type="text" id="bank" class="form-control" placeholder="Bank & Wallet" required>
        </div>

        <!-- Nama Rekening -->
        <div class="mb-3 input-group">
          <span class="input-group-text bg-white"><i class="bi bi-person" style="color: #007bff;"></i></span>
          <input type="text" id="namarekening" class="form-control" placeholder="Nama Pemilik Rekening" required>
        </div>

        <!-- Nomor Rekening -->
        <div class="mb-3 input-group">
          <span class="input-group-text bg-white"><i class="bi bi-credit-card" style="color: #007bff;"></i></span>
          <input type="text" id="rekening" class="form-control" placeholder="No. Rekening" required>
        </div>

        <!-- WhatsApp -->
        <div class="mb-4 input-group">
          <span class="input-group-text bg-white"><i class="bi bi-whatsapp" style="color: #007bff;"></i></span>
          <input type="text" id="wa" class="form-control" placeholder="Nomor WhatsApp Anda" required>
        </div>

        <button type="submit" class="btn btn-bongkar w-100 py-2">Kirim Permintaan Bongkar</button>
      </form>
    </div>
  </div>

  <script>
    // Copy ID button
    document.getElementById('copyIdBtn').addEventListener('click', () => {
      const input = document.getElementById('iddomino');
      navigator.clipboard.writeText(input.value).then(() => {
        const fb = document.getElementById('copyFeedback');
        fb.style.display = 'block';
        setTimeout(() => fb.style.display = 'none', 2000);
      });
    });

    const ratePerHalfB = 29000; // Harga per 0.5B
    const minHalfB = 0.5;       // Minimal 0.5B
    const template = `💰 *Mohon masukan permintaan anda*

📅 *Tanggal:* {tanggal}
🆔 *ID Toko Kami:* {iddomino}
🆔 *ID Anda:* {id}
📦 *Jumlah:* {jumlah}
💸 *Estimasi Dana:* {estimasi}
🏦 *Bank:* {bank}
👤 *Nama Rekening:* {namarekening}
🔢 *No Rekening:* {rekening}
📱 *WA:* {wa}

TERIMA KASIH 🙏🏻 `;
    const merchant = '6289668826364';

    const idEl = document.getElementById('id');
    const jumlahEl = document.getElementById('jumlah');
    const estimasiEl = document.getElementById('estimasi');
    const bankEl = document.getElementById('bank');
    const namarekeningEl = document.getElementById('namarekening');
    const rekeningEl = document.getElementById('rekening');
    const IDKAMIel = document.getElementById('iddomino');
    const waEl = document.getElementById('wa');
    const errorEl = document.getElementById('error');

    jumlahEl.addEventListener('input', () => {
      const v = jumlahEl.value.trim().toUpperCase();
      errorEl.textContent = '';
      estimasiEl.value = '';
      let jumlahB = null;

      if (v.endsWith('M')) {
        const numM = parseInt(v.slice(0, -1), 10);
        if (isNaN(numM) || numM < 500) {
          errorEl.textContent = 'Minimal bongkar 500M (0.5B)';
          return;
        }
        if (numM % 500 !== 0) {
          errorEl.textContent = 'Harus kelipatan 500M';
          return;
        }
        jumlahB = numM / 1000;
      }
      else if (v.endsWith('B')) {
        const numB = parseFloat(v.slice(0, -1).replace(',', '.'));
        if (isNaN(numB) || numB < minHalfB) {
          errorEl.textContent = 'Minimal bongkar 0.5B (500M)';
          return;
        }
        if ((numB * 10) % 5 !== 0) {
          errorEl.textContent = 'Harus kelipatan 0.5B';
          return;
        }
        jumlahB = numB;
      }
      else if (v !== '') {
        errorEl.textContent = 'Gunakan format "500M" atau "1B"';
        return;
      }

      if (jumlahB !== null) {
        const totalHalfB = jumlahB / 0.5; // hitung kelipatan 0.5B
        const harga = totalHalfB * ratePerHalfB;
        estimasiEl.value = 'Rp ' + harga.toLocaleString('id-ID');
      }
    });

    document.getElementById('bongkarForm').addEventListener('submit', async e => {
      e.preventDefault();
      if (!estimasiEl.value) {
        errorEl.textContent = 'Masukkan jumlah bongkar yang valid terlebih dahulu';
        return;
      }
      const id = idEl.value.trim();
      const jumlah = jumlahEl.value.trim().toUpperCase();
      const bank = bankEl.value.trim();
      const namarekening = namarekeningEl.value.trim();
      const rekening = rekeningEl.value.trim();
      const iddomino = IDKAMIel.value.trim();
      const wa = waEl.value.trim();
      const now = new Date();
      const bulan = ['Januari','Februari','Maret','April','Mei','Juni','Juli','Agustus','September','Oktober','November','Desember'];
      const tanggal = `${now.getDate()} ${bulan[now.getMonth()]} ${now.getFullYear()}, ${String(now.getHours()).padStart(2,'0')}.${String(now.getMinutes()).padStart(2,'0')}`;

      await fetch('?log=1', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ id, jumlah, bank, namarekening, rekening, iddomino, wa, estimasi: estimasiEl.value })
      });

      let msg = template
        .replace(/{tanggal}/g, tanggal)
        .replace(/{id}/g, id)
        .replace(/{jumlah}/g, jumlah)
        .replace(/{bank}/g, bank)
        .replace(/{namarekening}/g, namarekening)
        .replace(/{rekening}/g, rekening)
        .replace(/{iddomino}/g, iddomino)
        .replace(/{wa}/g, wa)
        .replace(/{estimasi}/g, estimasiEl.value);

      window.location.href = `https://api.whatsapp.com/send?phone=${merchant}&text=${encodeURIComponent(msg)}`;
    });
  </script>
</body>
</html>
